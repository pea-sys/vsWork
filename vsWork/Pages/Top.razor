@page "/top"
@inherits BasePage

    <vsWork.Components.Dialog Title=@dialogContent.Title
                               ContentLine1=@dialogContent.ContentLine1
                               ContentLine2=@dialogContent.ContentLine2
                               @bind-IsShow=@dialogContent.IsShow />

<div class="col-md-12 text-center">
    <div>
        <vsWork.Components.Clock />
    </div>

    <button class="btn btn-primary" @onclick="PunchIn">出勤</button>
    <button class="btn btn-secondary" @onclick="PunchOut">退勤</button>
</div>

@code {
    [Inject]
    protected IRepository<Attendance, string> attendanceRepository { get; set; }
    [Inject]
    protected CurrentUserService currentUserService { get; set; }

    //private string dialogContentLine1;
    //private string dialogContentLine2;
    //private string dialogTitle;
    private vsWork.Components.Dialog.DialogContent dialogContent = new Components.Dialog.DialogContent();
    /// <summary>
    /// 出勤打刻
    /// </summary>
    private async Task PunchIn()
    {
        // 後々、ユーザーの状態管理テーブルを作りたい。打刻に応じてトリガーで更新すれば良いと思う。
        // 打刻済みなら打刻させないようにする必要あり
        if (!string.IsNullOrEmpty(currentUserService.UserId))
        {
            attendanceRepository.Add(new Attendance() { UserId = currentUserService.UserId });
            dialogContent.Title = "打刻確認";
            dialogContent.ContentLine1 = "打刻しました";
            dialogContent.ContentLine2 = DateTime.Now.ToLongTimeString(); //実際にDBから引っ張るべき。今のところ利用国は日本のみに対応
            dialogContent.IsShow = true;
        }
    }
    /// <summary>
    /// 退勤打刻
    /// </summary>
    private async Task PunchOut()
    {

    }


}
